{
  "$id": "https://serverlessworkflow.io/schemas/1.0.0-alpha1/workflow.yaml",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Workflow",
  "description": "Serverless Workflow DSL - Workflow Schema",
  "type": "object",
  "properties": {
    "document": {
      "type": "object",
      "properties": {
        "dsl": {
          "type": "string",
          "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$",
          "description": "The version of the DSL used by the workflow."
        },
        "namespace": {
          "type": "string",
          "pattern": "^[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?$",
          "description": "The workflow's namespace."
        },
        "name": {
          "type": "string",
          "pattern": "^[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?$",
          "description": "The workflow's name."
        },
        "version": {
          "type": "string",
          "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$",
          "description": "The workflow's semantic version."
        },
        "title": {
          "type": "string",
          "description": "The workflow's title."
        },
        "summary": {
          "type": "string",
          "description": "The workflow's Markdown summary."
        },
        "tags": {
          "type": "object",
          "title": "WorkflowTags",
          "description": "A key/value mapping of the workflow's tags, if any."
        }
      },
      "required": [
        "dsl",
        "namespace",
        "name",
        "version"
      ],
      "title": "WorkflowDocument",
      "description": "Documents the workflow"
    },
    "input": {
      "$ref": "#/$defs/input",
      "title": "WorkflowInput",
      "description": "Configures the workflow's input."
    },
    "use": {
      "type": "object",
      "properties": {
        "authentications": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/$defs/authenticationPolicy"
          },
          "title": "WorkflowAuthentications",
          "description": "The workflow's reusable authentication policies."
        },
        "errors": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/$defs/error"
          },
          "title": "WorkflowErrors",
          "description": "The workflow's reusable errors."
        },
        "extensions": {
          "type": "array",
          "items": {
            "type": "object",
            "title": "ExtensionItem",
            "minProperties": 1,
            "maxProperties": 1,
            "additionalProperties": {
              "$ref": "#/$defs/extension"
            }
          },
          "title": "WorkflowExtensions",
          "description": "The workflow's extensions."
        },
        "functions": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/$defs/task"
          },
          "title": "WorkflowFunctions",
          "description": "The workflow's reusable functions."
        },
        "retries": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/$defs/retryPolicy"
          },
          "title": "WorkflowRetries",
          "description": "The workflow's reusable retry policies."
        },
        "secrets": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "title": "WorkflowSecrets",
          "description": "The workflow's secrets."
        }
      },
      "title": "WorkflowComponents",
      "description": "Defines the workflow's reusable components."
    },
    "do": {
      "$ref": "#/$defs/taskList",
      "title": "WorkflowTasks",
      "description": "Defines the task(s) the workflow must perform"
    },
    "timeout": {
      "$ref": "#/$defs/timeout",
      "title": "WorkflowTimeout",
      "description": "The workflow's timeout configuration, if any."
    },
    "output": {
      "$ref": "#/$defs/output",
      "title": "WorkflowOutput",
      "description": "Configures the workflow's output."
    },
    "schedule": {
      "type": "object",
      "properties": {
        "every": {
          "$ref": "#/$defs/duration",
          "description": "Specifies the duration of the interval at which the workflow should be executed."
        },
        "cron": {
          "type": "string",
          "description": "Specifies the schedule using a cron expression, e.g., '0 0 * * *' for daily at midnight.\""
        },
        "after": {
          "$ref": "#/$defs/duration",
          "description": "Specifies a delay duration that the workflow must wait before starting again after it completes."
        },
        "on": {
          "$ref": "#/$defs/eventConsumptionStrategy",
          "description": "Specifies the events that trigger the workflow execution."
        }
      },
      "title": "WorkflowSchedule",
      "description": "Schedules the workflow"
    }
  },
  "$defs": {
    "taskList": {
      "type": "array",
      "items": {
        "type": "object",
        "title": "TaskItem",
        "minProperties": 1,
        "maxProperties": 1,
        "additionalProperties": {
          "$ref": "#/$defs/task"
        }
      },
      "title": "TaskList",
      "description": "A name/value mapping of tasks"
    },
    "taskBase": {
      "type": "object",
      "properties": {
        "if": {
          "type": "string",
          "description": "A runtime expression, if any, used to determine whether or not the task should be run."
        },
        "input": {
          "$ref": "#/$defs/input",
          "description": "Configure the task's input."
        },
        "output": {
          "$ref": "#/$defs/output",
          "description": "Configure the task's output."
        },
        "export": {
          "$ref": "#/$defs/export",
          "description": "Export task output to context."
        },
        "timeout": {
          "$ref": "#/$defs/timeout",
          "description": "The task's timeout configuration, if any."
        },
        "then": {
          "$ref": "#/$defs/flowDirective",
          "description": "The flow directive to be performed upon completion of the task."
        }
      },
      "title": "TaskBase",
      "description": "The base definition shared by all tasks"
    },
    "task": {
      "unevaluatedProperties": false,
      "oneOf": [
        {
          "$ref": "#/$defs/callTask"
        },
        {
          "$ref": "#/$defs/doTask"
        },
        {
          "$ref": "#/$defs/forkTask"
        },
        {
          "$ref": "#/$defs/emitTask"
        },
        {
          "$ref": "#/$defs/forTask"
        },
        {
          "$ref": "#/$defs/listenTask"
        },
        {
          "$ref": "#/$defs/raiseTask"
        },
        {
          "$ref": "#/$defs/runTask"
        },
        {
          "$ref": "#/$defs/setTask"
        },
        {
          "$ref": "#/$defs/switchTask"
        },
        {
          "$ref": "#/$defs/tryTask"
        },
        {
          "$ref": "#/$defs/waitTask"
        }
      ],
      "title": "Task",
      "description": "Defines all possible tasks"
    },
    "callTask": {
      "oneOf": [
        {
          "title": "CallAsyncAPI",
          "description": "Enables workflows to interact with external services described by AsyncAPI.",
          "$ref": "#/$defs/taskBase",
          "type": "object",
          "required": [
            "call",
            "with"
          ],
          "unevaluatedProperties": false,
          "properties": {
            "call": {
              "type": "string",
              "const": "asyncapi"
            },
            "with": {
              "title": "CallAsyncAPIWith",
              "type": "object",
              "properties": {
                "document": {
                  "$ref": "#/$defs/externalResource",
                  "title": "CallAsyncAPIWithDocument",
                  "description": "The document that defines the AsyncAPI operation to call."
                },
                "operationRef": {
                  "type": "string",
                  "description": "A reference to the AsyncAPI operation to call."
                },
                "server": {
                  "type": "string",
                  "description": "A a reference to the server to call the specified AsyncAPI operation on. If not set, default to the first server matching the operation's channel."
                },
                "message": {
                  "type": "string",
                  "description": "The name of the message to use. If not set, defaults to the first message defined by the operation."
                },
                "binding": {
                  "type": "string",
                  "description": "The name of the binding to use. If not set, defaults to the first binding defined by the operation."
                },
                "payload": {
                  "type": "object",
                  "description": "The payload to call the AsyncAPI operation with, if any."
                },
                "authentication": {
                  "$ref": "#/$defs/referenceableAuthenticationPolicy",
                  "title": "CallAsyncAPIWithAuthentication",
                  "description": "The authentication policy, if any, to use when calling the AsyncAPI operation."
                }
              },
              "required": [
                "document",
                "operationRef"
              ],
              "additionalProperties": false,
              "description": "Defines the AsyncAPI call to perform."
            }
          }
        },
        {
          "title": "CallGRPC",
          "$ref": "#/$defs/taskBase",
          "type": "object",
          "unevaluatedProperties": false,
          "required": [
            "call",
            "with"
          ],
          "properties": {
            "call": {
              "type": "string",
              "const": "grpc"
            },
            "with": {
              "title": "CallGRPCWith",
              "type": "object",
              "properties": {
                "proto": {
                  "$ref": "#/$defs/externalResource",
                  "title": "CallGRPCWithProto",
                  "description": "The proto resource that describes the GRPC service to call."
                },
                "service": {
                  "type": "object",
                  "properties": {
                    "name": {
                      "type": "string",
                      "description": "The name of the GRPC service to call."
                    },
                    "host": {
                      "type": "string",
                      "pattern": "^[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?$",
                      "description": "The hostname of the GRPC service to call."
                    },
                    "port": {
                      "type": "integer",
                      "minimum": 0,
                      "maximum": 65535,
                      "description": "The port number of the GRPC service to call."
                    },
                    "authentication": {
                      "$ref": "#/$defs/referenceableAuthenticationPolicy",
                      "title": "CallGRPCWithServiceAuthentication",
                      "description": "The endpoint's authentication policy, if any."
                    }
                  },
                  "required": [
                    "name",
                    "host"
                  ],
                  "title": "CallGRPCWithService"
                },
                "method": {
                  "type": "string",
                  "description": "The name of the method to call on the defined GRPC service."
                },
                "arguments": {
                  "type": "object",
                  "additionalProperties": true,
                  "title": "CallGRPCWithArguments",
                  "description": "The arguments, if any, to call the method with."
                }
              },
              "required": [
                "proto",
                "service",
                "method"
              ],
              "additionalProperties": false,
              "description": "Defines the GRPC call to perform."
            }
          }
        },
        {
          "title": "CallHTTP",
          "$ref": "#/$defs/taskBase",
          "type": "object",
          "unevaluatedProperties": false,
          "required": [
            "call",
            "with"
          ],
          "properties": {
            "call": {
              "type": "string",
              "const": "http"
            },
            "with": {
              "title": "CallHTTPWith",
              "type": "object",
              "properties": {
                "method": {
                  "type": "string",
                  "description": "The HTTP method of the HTTP request to perform."
                },
                "endpoint": {
                  "title": "CallHTTPWithEndpoint",
                  "description": "The HTTP endpoint to send the request to.",
                  "oneOf": [
                    {
                      "$ref": "#/$defs/endpoint"
                    },
                    {
                      "type": "string",
                      "format": "uri-template"
                    }
                  ]
                },
                "headers": {
                  "type": "object",
                  "title": "CallHTTPWithHeaders",
                  "description": "A name/value mapping of the headers, if any, of the HTTP request to perform."
                },
                "body": {
                  "title": "CallHTTPWithBody",
                  "description": "The body, if any, of the HTTP request to perform."
                },
                "output": {
                  "type": "string",
                  "enum": [
                    "raw",
                    "content",
                    "response"
                  ],
                  "description": "The http call output format. Defaults to 'content'."
                }
              },
              "required": [
                "method",
                "endpoint"
              ],
              "additionalProperties": false,
              "description": "Defines the HTTP call to perform."
            }
          }
        },
        {
          "title": "CallOpenAPI",
          "$ref": "#/$defs/taskBase",
          "type": "object",
          "unevaluatedProperties": false,
          "required": [
            "call",
            "with"
          ],
          "properties": {
            "call": {
              "type": "string",
              "const": "openapi"
            },
            "with": {
              "title": "CallOpenAPIWith",
              "type": "object",
              "properties": {
                "document": {
                  "$ref": "#/$defs/externalResource",
                  "title": "CallOpenAPIWithDocument",
                  "description": "The document that defines the OpenAPI operation to call."
                },
                "operationId": {
                  "type": "string",
                  "description": "The id of the OpenAPI operation to call."
                },
                "parameters": {
                  "type": "object",
                  "additionalProperties": true,
                  "title": "CallOpenAPIWithParameters",
                  "description": "A name/value mapping of the parameters of the OpenAPI operation to call."
                },
                "authentication": {
                  "$ref": "#/$defs/referenceableAuthenticationPolicy",
                  "title": "CallOpenAPIWithAuthentication",
                  "description": "The authentication policy, if any, to use when calling the OpenAPI operation."
                },
                "output": {
                  "type": "string",
                  "enum": [
                    "raw",
                    "content",
                    "response"
                  ],
                  "description": "The http call output format. Defaults to 'content'."
                }
              },
              "required": [
                "document",
                "operationId"
              ],
              "additionalProperties": false,
              "description": "Defines the OpenAPI call to perform."
            }
          }
        },
        {
          "title": "CallFunction",
          "$ref": "#/$defs/taskBase",
          "type": "object",
          "unevaluatedProperties": false,
          "required": [
            "call"
          ],
          "properties": {
            "call": {
              "type": "string",
              "not": {
                "enum": [
                  "asyncapi",
                  "grpc",
                  "http",
                  "openapi"
                ]
              },
              "description": "The name of the function to call."
            },
            "with": {
              "type": "object",
              "additionalProperties": true,
              "title": "CallFunctionWith",
              "description": "A name/value mapping of the parameters, if any, to call the function with."
            }
          }
        }
      ],
      "title": "CallTask",
      "description": "Enables the execution of a specified function within a workflow, allowing seamless integration with custom business logic or external services"
    },
    "forkTask": {
      "additionalProperties": {
        "$ref": "#/$defs/taskBase"
      },
      "type": "object",
      "unevaluatedProperties": false,
      "required": [
        "fork"
      ],
      "properties": {
        "fork": {
          "type": "object",
          "required": [
            "branches"
          ],
          "properties": {
            "branches": {
              "$ref": "#/$defs/taskList",
              "title": "Branches"
            },
            "compete": {
              "description": "Indicates whether or not the concurrent tasks are racing against each other, with a single possible winner, which sets the composite task's output.",
              "type": "boolean",
              "default": false
            }
          },
          "title": "Fork"
        }
      },
      "title": "ForkTask",
      "description": "Allows workflows to execute multiple tasks concurrently and optionally race them against each other, with a single possible winner, which sets the task's output."
    },
    "doTask": {
      "title": "DoTask",
      "description": "Allows to execute a list of tasks in sequence",
      "$ref": "#/$defs/taskBase",
      "type": "object",
      "unevaluatedProperties": false,
      "required": [
        "do"
      ],
      "properties": {
        "do": {
          "$ref": "#/$defs/taskList",
          "title": "Do"
        }
      }
    },
    "emitTask": {
      "title": "EmitTask",
      "description": "Allows workflows to publish events to event brokers or messaging systems, facilitating communication and coordination between different components and services.",
      "$ref": "#/$defs/taskBase",
      "type": "object",
      "required": [
        "emit"
      ],
      "unevaluatedProperties": false,
      "properties": {
        "emit": {
          "type": "object",
          "properties": {
            "event": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string",
                  "description": "The event's unique identifier"
                },
                "source": {
                  "type": "string",
                  "format": "uri",
                  "description": "Identifies the context in which an event happened"
                },
                "type": {
                  "type": "string",
                  "description": "This attribute contains a value describing the type of event related to the originating occurrence."
                },
                "time": {
                  "type": "string",
                  "format": "date-time"
                },
                "subject": {
                  "type": "string"
                },
                "datacontenttype": {
                  "type": "string",
                  "description": "Content type of data value. This attribute enables data to carry any type of content, whereby format and encoding might differ from that of the chosen event format."
                },
                "dataschema": {
                  "type": "string",
                  "format": "uri"
                }
              },
              "required": [
                "source",
                "type"
              ],
              "additionalProperties": true,
              "title": "EmitEvent"
            }
          },
          "required": [
            "event"
          ],
          "title": "Emit"
        }
      }
    },
    "forTask": {
      "title": "ForTask",
      "description": "Allows workflows to iterate over a collection of items, executing a defined set of subtasks for each item in the collection. This task type is instrumental in handling scenarios such as batch processing, data transformation, and repetitive operations across datasets.",
      "$ref": "#/$defs/taskBase",
      "type": "object",
      "required": [
        "for",
        "do"
      ],
      "unevaluatedProperties": false,
      "properties": {
        "for": {
          "type": "object",
          "properties": {
            "each": {
              "type": "string",
              "description": "The name of the variable used to store the current item being enumerated.",
              "default": "item"
            },
            "in": {
              "type": "string",
              "description": "A runtime expression used to get the collection to enumerate."
            },
            "at": {
              "type": "string",
              "description": "The name of the variable used to store the index of the current item being enumerated.",
              "default": "index"
            }
          },
          "required": [
            "in"
          ],
          "title": "For"
        },
        "while": {
          "type": "string",
          "description": "A runtime expression that represents the condition, if any, that must be met for the iteration to continue."
        },
        "do": {
          "$ref": "#/$defs/taskList",
          "title": "DoEach"
        }
      }
    },
    "listenTask": {
      "title": "ListenTask",
      "description": "Provides a mechanism for workflows to await and react to external events, enabling event-driven behavior within workflow systems.",
      "$ref": "#/$defs/taskBase",
      "type": "object",
      "required": [
        "listen"
      ],
      "unevaluatedProperties": false,
      "properties": {
        "listen": {
          "type": "object",
          "properties": {
            "to": {
              "$ref": "#/$defs/eventConsumptionStrategy",
              "title": "ListenEventConsumptionStrategy",
              "description": "Defines the event(s) to listen to."
            }
          },
          "required": [
            "to"
          ],
          "title": "Listen"
        }
      }
    },
    "raiseTask": {
      "title": "RaiseTask",
      "description": "Intentionally triggers and propagates errors.",
      "$ref": "#/$defs/taskBase",
      "type": "object",
      "required": [
        "raise"
      ],
      "unevaluatedProperties": false,
      "properties": {
        "raise": {
          "type": "object",
          "properties": {
            "error": {
              "$ref": "#/$defs/error",
              "title": "RaiseError",
              "description": "Defines the error to raise."
            }
          },
          "required": [
            "error"
          ],
          "title": "Raise"
        }
      }
    },
    "runTask": {
      "title": "RunTask",
      "description": "Provides the capability to execute external containers, shell commands, scripts, or workflows.",
      "$ref": "#/$defs/taskBase",
      "type": "object",
      "required": [
        "run"
      ],
      "unevaluatedProperties": false,
      "properties": {
        "run": {
          "type": "object",
          "oneOf": [
            {
              "title": "RunContainer",
              "properties": {
                "container": {
                  "type": "object",
                  "properties": {
                    "image": {
                      "type": "string",
                      "description": "The name of the container image to run."
                    },
                    "command": {
                      "type": "string",
                      "description": "The command, if any, to execute on the container"
                    },
                    "ports": {
                      "type": "object",
                      "description": "The container's port mappings, if any."
                    },
                    "volumes": {
                      "type": "object",
                      "description": "The container's volume mappings, if any."
                    },
                    "environment": {
                      "title": "ContainerEnvironment",
                      "type": "object",
                      "description": "A key/value mapping of the environment variables, if any, to use when running the configured process."
                    }
                  },
                  "required": [
                    "image"
                  ],
                  "title": "Container"
                }
              },
              "required": [
                "container"
              ],
              "description": "Enables the execution of external processes encapsulated within a containerized environment."
            },
            {
              "title": "RunScript",
              "properties": {
                "script": {
                  "type": "object",
                  "properties": {
                    "language": {
                      "type": "string",
                      "description": "The language of the script to run."
                    },
                    "environment": {
                      "title": "ScriptEnvironment",
                      "type": "object",
                      "additionalProperties": true,
                      "description": "A key/value mapping of the environment variables, if any, to use when running the configured process."
                    }
                  },
                  "oneOf": [
                    {
                      "title": "ScriptInline",
                      "properties": {
                        "code": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "code"
                      ],
                      "description": "The script's code."
                    },
                    {
                      "title": "ScriptExternal",
                      "properties": {
                        "source": {
                          "$ref": "#/$defs/externalResource"
                        }
                      },
                      "description": "The script's resource.",
                      "required": [
                        "source"
                      ]
                    }
                  ],
                  "required": [
                    "language"
                  ],
                  "title": "Script"
                }
              },
              "required": [
                "script"
              ],
              "description": "Enables the execution of custom scripts or code within a workflow, empowering workflows to perform specialized logic, data processing, or integration tasks by executing user-defined scripts written in various programming languages."
            },
            {
              "title": "RunShell",
              "properties": {
                "shell": {
                  "type": "object",
                  "properties": {
                    "command": {
                      "type": "string",
                      "description": "The shell command to run."
                    },
                    "arguments": {
                      "title": "ShellArguments",
                      "type": "object",
                      "additionalProperties": true,
                      "description": "A list of the arguments of the shell command to run."
                    },
                    "environment": {
                      "title": "ShellEnvironment",
                      "type": "object",
                      "additionalProperties": true,
                      "description": "A key/value mapping of the environment variables, if any, to use when running the configured process."
                    }
                  },
                  "required": [
                    "command"
                  ],
                  "title": "Shell"
                }
              },
              "required": [
                "shell"
              ],
              "description": "Enables the execution of shell commands within a workflow, enabling workflows to interact with the underlying operating system and perform system-level operations, such as file manipulation, environment configuration, or system administration tasks."
            },
            {
              "title": "RunWokflow",
              "properties": {
                "workflow": {
                  "title": "RunWorkflowDescriptor",
                  "type": "object",
                  "properties": {
                    "namespace": {
                      "type": "string",
                      "description": "The namespace the workflow to run belongs to."
                    },
                    "name": {
                      "type": "string",
                      "description": "The name of the workflow to run."
                    },
                    "version": {
                      "type": "string",
                      "default": "latest",
                      "description": "The version of the workflow to run. Defaults to latest"
                    },
                    "input": {
                      "title": "WorkflowInput",
                      "type": "object",
                      "additionalProperties": true,
                      "description": "The data, if any, to pass as input to the workflow to execute. The value should be validated against the target workflow's input schema, if specified."
                    }
                  },
                  "required": [
                    "namespace",
                    "name",
                    "version"
                  ]
                }
              },
              "required": [
                "workflow"
              ],
              "description": "Enables the invocation and execution of nested workflows within a parent workflow, facilitating modularization, reusability, and abstraction of complex logic or business processes by encapsulating them into standalone workflow units."
            }
          ],
          "title": "Run"
        }
      }
    },
    "setTask": {
      "title": "SetTask",
      "description": "A task used to set data",
      "$ref": "#/$defs/taskBase",
      "type": "object",
      "required": [
        "set"
      ],
      "unevaluatedProperties": false,
      "properties": {
        "set": {
          "type": "object",
          "minProperties": 1,
          "additionalProperties": true,
          "title": "Set",
          "description": "The data to set"
        }
      }
    },
    "switchTask": {
      "title": "SwitchTask",
      "description": "Enables conditional branching within workflows, allowing them to dynamically select different paths based on specified conditions or criteria",
      "$ref": "#/$defs/taskBase",
      "type": "object",
      "required": [
        "switch"
      ],
      "unevaluatedProperties": false,
      "properties": {
        "switch": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "minProperties": 1,
            "maxProperties": 1,
            "title": "SwitchItem",
            "additionalProperties": {
              "type": "object",
              "title": "SwitchCase",
              "required": [
                "then"
              ],
              "properties": {
                "when": {
                  "type": "string",
                  "description": "A runtime expression used to determine whether or not the case matches."
                },
                "then": {
                  "$ref": "#/$defs/flowDirective",
                  "description": "The flow directive to execute when the case matches."
                }
              }
            }
          },
          "title": "Switch"
        }
      }
    },
    "tryTask": {
      "title": "TryTask",
      "description": "Serves as a mechanism within workflows to handle errors gracefully, potentially retrying failed tasks before proceeding with alternate ones.",
      "$ref": "#/$defs/taskBase",
      "type": "object",
      "required": [
        "try",
        "catch"
      ],
      "unevaluatedProperties": false,
      "properties": {
        "try": {
          "$ref": "#/$defs/taskList",
          "title": "Try",
          "description": "The task(s) to perform."
        },
        "catch": {
          "type": "object",
          "properties": {
            "errors": {
              "type": "object",
              "title": "CatchErrors"
            },
            "as": {
              "type": "string",
              "description": "The name of the runtime expression variable to save the error as. Defaults to 'error'."
            },
            "when": {
              "type": "string",
              "description": "A runtime expression used to determine whether or not to catch the filtered error"
            },
            "exceptWhen": {
              "type": "string",
              "description": "A runtime expression used to determine whether or not to catch the filtered error"
            },
            "retry": {
              "$ref": "#/$defs/retryPolicy",
              "title": "CatchRetryPolicy",
              "description": "The retry policy to use, if any, when catching errors."
            },
            "do": {
              "$ref": "#/$defs/taskList",
              "title": "CatchDo",
              "description": "The definition of the task(s) to run when catching an error."
            }
          },
          "title": "Catch"
        }
      }
    },
    "waitTask": {
      "title": "WaitTask",
      "description": "Allows workflows to pause or delay their execution for a specified period of time.",
      "$ref": "#/$defs/taskBase",
      "type": "object",
      "required": [
        "wait"
      ],
      "unevaluatedProperties": false,
      "properties": {
        "wait": {
          "$ref": "#/$defs/duration",
          "title": "Wait",
          "description": "The amount of time to wait."
        }
      }
    },
    "flowDirective": {
      "anyOf": [
        {
          "type": "string",
          "enum": [
            "continue",
            "exit",
            "end"
          ],
          "default": "continue",
          "title": "FlowDirectiveEnum"
        },
        {
          "type": "string"
        }
      ],
      "title": "FlowDirective"
    },
    "referenceableAuthenticationPolicy": {
      "type": "object",
      "oneOf": [
        {
          "title": "AuthenticationPolicyReference",
          "properties": {
            "use": {
              "type": "string",
              "minLength": 1,
              "description": "The name of the authentication policy to use"
            }
          },
          "required": [
            "use"
          ]
        },
        {
          "$ref": "#/$defs/authenticationPolicy",
          "title": "ReferencedAuthenticationPolicy"
        }
      ],
      "title": "ReferenceableAuthenticationPolicy"
    },
    "secretBasedAuthenticationPolicy": {
      "type": "object",
      "properties": {
        "use": {
          "type": "string",
          "minLength": 1,
          "description": "The name of the authentication policy to use"
        }
      },
      "required": [
        "use"
      ],
      "title": "SecretBasedAuthenticationPolicy"
    },
    "authenticationPolicy": {
      "type": "object",
      "oneOf": [
        {
          "title": "BasicAuthenticationPolicy",
          "properties": {
            "basic": {
              "type": "object",
              "oneOf": [
                {
                  "properties": {
                    "username": {
                      "type": "string",
                      "description": "The username to use."
                    },
                    "password": {
                      "type": "string",
                      "description": "The password to use."
                    }
                  },
                  "required": [
                    "username",
                    "password"
                  ],
                  "title": "ExplicitBasicAuthenticationPolicy"
                },
                {
                  "$ref": "#/$defs/secretBasedAuthenticationPolicy"
                }
              ]
            }
          },
          "required": [
            "basic"
          ],
          "description": "Use basic authentication."
        },
        {
          "title": "BearerAuthenticationPolicy",
          "properties": {
            "bearer": {
              "type": "object",
              "oneOf": [
                {
                  "properties": {
                    "token": {
                      "type": "string",
                      "description": "The bearer token to use."
                    }
                  },
                  "required": [
                    "token"
                  ],
                  "title": "ExplicitBearerAuthenticationPolicy"
                },
                {
                  "$ref": "#/$defs/secretBasedAuthenticationPolicy"
                }
              ]
            }
          },
          "required": [
            "bearer"
          ],
          "description": "Use bearer authentication."
        },
        {
          "title": "OAuth2AuthenticationPolicy",
          "properties": {
            "oauth2": {
              "type": "object",
              "oneOf": [
                {
                  "properties": {
                    "authority": {
                      "type": "string",
                      "format": "uri",
                      "description": "The URI that references the OAuth2 authority to use."
                    },
                    "grant": {
                      "type": "string",
                      "description": "The grant type to use."
                    },
                    "client": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string",
                          "description": "The client id to use."
                        },
                        "secret": {
                          "type": "string",
                          "description": "The client secret to use, if any."
                        }
                      },
                      "required": [
                        "id"
                      ]
                    },
                    "scopes": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "description": "The scopes, if any, to request the token for."
                    },
                    "audiences": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "description": "The audiences, if any, to request the token for."
                    },
                    "username": {
                      "type": "string",
                      "description": "The username to use. Used only if the grant type is Password."
                    },
                    "password": {
                      "type": "string",
                      "description": "The password to use. Used only if the grant type is Password."
                    },
                    "subject": {
                      "$ref": "#/$defs/oauth2Token",
                      "description": "The security token that represents the identity of the party on behalf of whom the request is being made."
                    },
                    "actor": {
                      "$ref": "#/$defs/oauth2Token",
                      "description": "The security token that represents the identity of the acting party."
                    }
                  },
                  "required": [
                    "authority",
                    "grant",
                    "client"
                  ],
                  "title": "ExplicitOAuth2AuthenticationPolicy"
                },
                {
                  "$ref": "#/$defs/secretBasedAuthenticationPolicy"
                }
              ]
            }
          },
          "required": [
            "oauth2"
          ],
          "description": "Use OAUTH2 authentication."
        }
      ],
      "title": "AuthenticationPolicy",
      "description": "Defines an authentication policy."
    },
    "oauth2Token": {
      "type": "object",
      "properties": {
        "token": {
          "type": "string",
          "description": "The security token to use to use."
        },
        "type": {
          "type": "string",
          "description": "The type of the security token to use to use."
        }
      },
      "required": [
        "token",
        "type"
      ],
      "title": "OAuth2Token"
    },
    "duration": {
      "type": "object",
      "minProperties": 1,
      "properties": {
        "days": {
          "type": "integer",
          "description": "Number of days, if any."
        },
        "hours": {
          "type": "integer",
          "description": "Number of days, if any."
        },
        "minutes": {
          "type": "integer",
          "description": "Number of minutes, if any."
        },
        "seconds": {
          "type": "integer",
          "description": "Number of seconds, if any."
        },
        "milliseconds": {
          "type": "integer",
          "description": "Number of milliseconds, if any."
        }
      },
      "title": "Duration",
      "description": "The definition of a duration."
    },
    "error": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "format": "uri",
          "description": "A URI reference that identifies the error type."
        },
        "status": {
          "type": "integer",
          "description": "The status code generated by the origin for this occurrence of the error."
        },
        "instance": {
          "type": "string",
          "format": "json-pointer",
          "description": "A JSON Pointer used to reference the component the error originates from."
        },
        "title": {
          "type": "string",
          "description": "A short, human-readable summary of the error."
        },
        "detail": {
          "type": "string",
          "description": "A human-readable explanation specific to this occurrence of the error."
        }
      },
      "title": "Error",
      "required": [
        "type",
        "status",
        "instance"
      ]
    },
    "endpoint": {
      "type": "object",
      "properties": {
        "uri": {
          "type": "string",
          "format": "uri-template",
          "description": "The endpoint's URI."
        },
        "authentication": {
          "$ref": "#/$defs/referenceableAuthenticationPolicy",
          "title": "EndpointAuthentication",
          "description": "The authentication policy to use."
        }
      },
      "title": "Endpoint",
      "required": [
        "uri"
      ]
    },
    "eventConsumptionStrategy": {
      "type": "object",
      "oneOf": [
        {
          "title": "AllEventConsumptionStrategy",
          "properties": {
            "all": {
              "type": "array",
              "items": {
                "$ref": "#/$defs/eventFilter"
              },
              "title": "EventConsumptionStrategyAll",
              "description": "A list containing all the events that must be consumed."
            }
          },
          "required": [
            "all"
          ]
        },
        {
          "title": "AnyEventConsumptionStrategy",
          "properties": {
            "any": {
              "type": "array",
              "items": {
                "$ref": "#/$defs/eventFilter"
              },
              "title": "EventConsumptionStrategyAny",
              "description": "A list containing any of the events to consume."
            }
          },
          "required": [
            "any"
          ]
        },
        {
          "title": "OneEventConsumptionStrategy",
          "properties": {
            "one": {
              "$ref": "#/$defs/eventFilter",
              "title": "EventConsumptionStrategyOne",
              "description": "The single event to consume."
            }
          },
          "required": [
            "one"
          ]
        }
      ],
      "title": "EventConsumptionStrategy"
    },
    "eventFilter": {
      "type": "object",
      "properties": {
        "with": {
          "title": "WithEvent",
          "type": "object",
          "minProperties": 1,
          "properties": {
            "id": {
              "type": "string",
              "description": "The event's unique identifier"
            },
            "source": {
              "type": "string",
              "description": "Identifies the context in which an event happened"
            },
            "type": {
              "type": "string",
              "description": "This attribute contains a value describing the type of event related to the originating occurrence."
            },
            "time": {
              "type": "string"
            },
            "subject": {
              "type": "string"
            },
            "datacontenttype": {
              "type": "string",
              "description": "Content type of data value. This attribute enables data to carry any type of content, whereby format and encoding might differ from that of the chosen event format."
            },
            "dataschema": {
              "type": "string"
            }
          },
          "additionalProperties": true,
          "description": "An event filter is a mechanism used to selectively process or handle events based on predefined criteria, such as event type, source, or specific attributes."
        },
        "correlate": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "from": {
                "type": "string",
                "description": "A runtime expression used to extract the correlation value from the filtered event."
              },
              "expect": {
                "type": "string",
                "description": "A constant or a runtime expression, if any, used to determine whether or not the extracted correlation value matches expectations. If not set, the first extracted value will be used as the correlation's expectation."
              }
            },
            "required": [
              "from"
            ]
          },
          "title": "Correlate",
          "description": "A correlation is a link between events and data, established by mapping event attributes to specific data attributes, allowing for coordinated processing or handling based on event characteristics."
        }
      },
      "required": [
        "with"
      ],
      "title": "EventFilter",
      "description": "An event filter is a mechanism used to selectively process or handle events based on predefined criteria, such as event type, source, or specific attributes."
    },
    "extension": {
      "type": "object",
      "properties": {
        "extend": {
          "type": "string",
          "enum": [
            "call",
            "composite",
            "emit",
            "for",
            "listen",
            "raise",
            "run",
            "set",
            "switch",
            "try",
            "wait",
            "all"
          ],
          "description": "The type of task to extend."
        },
        "when": {
          "type": "string",
          "description": "A runtime expression, if any, used to determine whether or not the extension should apply in the specified context."
        },
        "before": {
          "$ref": "#/$defs/taskList",
          "title": "ExtensionBefore",
          "description": "The task(s) to execute before the extended task, if any."
        },
        "after": {
          "$ref": "#/$defs/taskList",
          "title": "ExtensionAfter",
          "description": "The task(s) to execute after the extended task, if any."
        }
      },
      "required": [
        "extend"
      ],
      "title": "Extension",
      "description": "The definition of a an extension."
    },
    "externalResource": {
      "oneOf": [
        {
          "type": "string",
          "format": "uri"
        },
        {
          "title": "ExternalResourceURI",
          "type": "object",
          "properties": {
            "uri": {
              "type": "string",
              "format": "uri",
              "description": "The endpoint's URI."
            },
            "authentication": {
              "$ref": "#/$defs/referenceableAuthenticationPolicy",
              "description": "The authentication policy to use."
            },
            "name": {
              "type": "string",
              "description": "The external resource's name, if any."
            }
          },
          "required": [
            "uri"
          ]
        }
      ],
      "title": "ExternalResource"
    },
    "input": {
      "type": "object",
      "properties": {
        "schema": {
          "$ref": "#/$defs/schema",
          "title": "InputSchema",
          "description": "The schema used to describe and validate the input of the workflow or task."
        },
        "from": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "object"
            }
          ],
          "title": "InputFrom",
          "description": "A runtime expression, if any, used to mutate and/or filter the input of the workflow or task."
        }
      },
      "title": "Input",
      "description": "Configures the input of a workflow or task."
    },
    "output": {
      "type": "object",
      "properties": {
        "schema": {
          "$ref": "#/$defs/schema",
          "title": "OutputSchema",
          "description": "The schema used to describe and validate the output of the workflow or task."
        },
        "as": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "object"
            }
          ],
          "title": "OutputAs",
          "description": "A runtime expression, if any, used to mutate and/or filter the output of the workflow or task."
        }
      },
      "title": "Output",
      "description": "Configures the output of a workflow or task."
    },
    "export": {
      "type": "object",
      "properties": {
        "schema": {
          "$ref": "#/$defs/schema",
          "title": "ExportSchema",
          "description": "The schema used to describe and validate the workflow context."
        },
        "as": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "object"
            }
          ],
          "title": "ExportAs",
          "description": "A runtime expression, if any, used to export the output data to the context."
        }
      },
      "title": "Export",
      "description": "Set the content of the context."
    },
    "retryPolicy": {
      "type": "object",
      "properties": {
        "when": {
          "type": "string",
          "description": "A runtime expression, if any, used to determine whether or not to retry running the task, in a given context."
        },
        "exceptWhen": {
          "type": "string",
          "description": "A runtime expression used to determine whether or not to retry running the task, in a given context."
        },
        "delay": {
          "$ref": "#/$defs/duration",
          "title": "RetryPolicyDelay",
          "description": "The duration to wait between retry attempts."
        },
        "backoff": {
          "type": "object",
          "title": "RetryPolicyBackoff",
          "oneOf": [
            {
              "title": "ConstantBackoff",
              "properties": {
                "constant": {
                  "type": "object",
                  "description": "The definition of the constant backoff to use, if any."
                }
              },
              "required": [
                "constant"
              ]
            },
            {
              "title": "ExponentialBackOff",
              "properties": {
                "exponential": {
                  "type": "object",
                  "description": "The definition of the exponential backoff to use, if any."
                }
              },
              "required": [
                "exponential"
              ]
            },
            {
              "title": "LinearBackoff",
              "properties": {
                "linear": {
                  "type": "object",
                  "description": "The definition of the linear backoff to use, if any."
                }
              },
              "required": [
                "linear"
              ]
            }
          ],
          "description": "The retry duration backoff."
        },
        "limit": {
          "type": "object",
          "title": "RetryPolicyLimit",
          "properties": {
            "attempt": {
              "title": "RetryPolicyAttempt",
              "type": "object",
              "properties": {
                "count": {
                  "type": "integer",
                  "description": "The maximum amount of retry attempts, if any."
                },
                "duration": {
                  "$ref": "#/$defs/duration",
                  "title": "RetryPolicyAttemptDuration",
                  "description": "The maximum duration for each retry attempt."
                }
              }
            },
            "duration": {
              "$ref": "#/$defs/duration",
              "title": "RetryPolicyDuration",
              "description": "The duration limit, if any, for all retry attempts."
            }
          },
          "description": "The retry limit, if any"
        },
        "jitter": {
          "title": "RetryPolicyJitter",
          "type": "object",
          "properties": {
            "from": {
              "$ref": "#/$defs/duration",
              "title": "RetryPolicyJitterFrom",
              "description": "The minimum duration of the jitter range"
            },
            "to": {
              "$ref": "#/$defs/duration",
              "title": "RetryPolicyJitterTo",
              "description": "The maximum duration of the jitter range"
            }
          },
          "required": [
            "from",
            "to"
          ],
          "description": "The parameters, if any, that control the randomness or variability of the delay between retry attempts."
        }
      },
      "title": "RetryPolicy",
      "description": "Defines a retry policy."
    },
    "schema": {
      "type": "object",
      "properties": {
        "format": {
          "type": "string",
          "default": "json",
          "description": "The schema's format. Defaults to 'json'. The (optional) version of the format can be set using `{format}:{version}`."
        }
      },
      "oneOf": [
        {
          "title": "SchemaInline",
          "properties": {
            "document": {
              "description": "The schema's inline definition."
            }
          },
          "required": [
            "document"
          ]
        },
        {
          "title": "SchemaExternal",
          "properties": {
            "resource": {
              "$ref": "#/$defs/externalResource",
              "description": "The schema's external resource."
            }
          },
          "required": [
            "resource"
          ]
        }
      ],
      "title": "Schema",
      "description": "Represents the definition of a schema."
    },
    "timeout": {
      "type": "object",
      "properties": {
        "after": {
          "$ref": "#/$defs/duration",
          "description": "The duration after which to timeout."
        }
      },
      "required": [
        "after"
      ],
      "title": "Timeout",
      "description": "The definition of a timeout."
    }
  },
  "required": [
    "document",
    "do"
  ]
}